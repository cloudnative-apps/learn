<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Docker and Kubernets - Tech Blog</title><meta name=Description content="Docker, kubernets ,AKS, EKS, ECS etc"><meta property="og:title" content="Docker and Kubernets"><meta property="og:description" content="Docker, kubernets ,AKS, EKS, ECS etc"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/learn/conainerization/"><meta property="og:image" content="http://localhost:1313/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-06T21:29:01+08:00"><meta property="article:modified_time" content="2023-09-12T08:41:23+05:30"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/logo.png"><meta name=twitter:title content="Docker and Kubernets"><meta name=twitter:description content="Docker, kubernets ,AKS, EKS, ECS etc"><meta name=application-name content="FeelIt"><meta name=apple-mobile-web-app-title content="FeelIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=../favicon.ico><link rel=icon type=image/png sizes=32x32 href=../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=../apple-touch-icon.png><link rel=mask-icon href=../safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=../site.webmanifest><link rel=canonical href=http://localhost:1313/learn/conainerization/><link rel=prev href=http://localhost:1313/learn/theme-documentation-basics/><link rel=next href=http://localhost:1313/learn/labs/><link rel=stylesheet href=../css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Docker and Kubernets","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/localhost:1313\/learn\/conainerization\/"},"image":["http:\/\/localhost:1313\/images\/Apple-Devices-Preview.webp"],"genre":"posts","keywords":"docker, kubernets, container, microservice","wordcount":2204,"url":"http:\/\/localhost:1313\/learn\/conainerization\/","datePublished":"2020-03-06T21:29:01+08:00","dateModified":"2023-09-12T08:41:23+05:30","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"http:\/\/localhost:1313\/images\/avatar.webp"},"author":{"@type":"Person","name":"Sharad"},"description":"Docker, kubernets ,AKS, EKS, ECS etc"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=../ title="Tech Blog"><span class=header-title-pre><i class="fas fa-hand-holding-heart fa-fw"></i></span>Tech Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=../posts/>Posts </a><a class=menu-item href=../tags/>Tags </a><a class=menu-item href=../categories/>Categories </a><a class=menu-item href=../categories/documentation/>Docs </a><a class=menu-item href=../about/>About </a><a class=menu-item href=../aws-services/ title="AWS Services">AWS </a><a class=menu-item href=../azure-services/ title="AWS Services">Azure </a><a class=menu-item href=../mypost/ title=Databases>Databases </a><a class=menu-item href=../devops/ title=DevOps>DevOps </a><a class=menu-item href=../graph-ql/ title="Graph QL">Graph QL </a><a class=menu-item href=../microservices/ title=Microservices>Microservices </a><a class=menu-item href=../net-microservice/ title="System Design">System Design </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/conainerization/ selected>English</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=../ title="Tech Blog"><span class=header-title-pre><i class="fas fa-hand-holding-heart fa-fw"></i></span>Tech Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=../posts/ title>Posts</a><a class=menu-item href=../tags/ title>Tags</a><a class=menu-item href=../categories/ title>Categories</a><a class=menu-item href=../categories/documentation/ title>Docs</a><a class=menu-item href=../about/ title>About</a><a class=menu-item href=../aws-services/ title="AWS Services">AWS</a><a class=menu-item href=../azure-services/ title="AWS Services">Azure</a><a class=menu-item href=../mypost/ title=Databases>Databases</a><a class=menu-item href=../devops/ title=DevOps>DevOps</a><a class=menu-item href=../graph-ql/ title="Graph QL">Graph QL</a><a class=menu-item href=../microservices/ title=Microservices>Microservices</a><a class=menu-item href=../net-microservice/ title="System Design">System Design</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/conainerization/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Docker and Kubernets</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://sharadsingh.net title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Sharad</a></span>&nbsp;<span class=post-category>included in <a href=../categories/documentation/><i class="far fa-folder fa-fw" aria-hidden=true></i>Documentation</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2020-03-06>2020-03-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2204 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;11 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#docker>Docker</a><ul><li><a href=#install-docker>Install Docker</a><ul><li><a href=#install-docker-windows>Install Docker: Windows</a></li><li><a href=#install-docker-linux>Install Docker: Linux</a></li><li><a href=#install-docker-mac>Install Docker: Mac</a><ul><li><a href=#commands>Commands</a></li></ul></li><li><a href=#exec--execute-a-command>Exec – execute a command</a><ul><li><a href=#run--attach-and-detach>Run – attach and detach</a></li><li><a href=#run--tag>Run – tag</a></li></ul></li><li><a href=#run-volume-mapping>Run volume mapping</a><ul><li><a href=#inspect-container>Inspect container</a></li><li><a href=#containers-log>Container&rsquo;s log</a></li><li><a href=#environment-variable>Environment variable</a></li></ul></li><li><a href=#docker-networking>Docker Networking</a></li></ul></li></ul></li><li><a href=#kubernetes>Kubernetes</a><ul><li><ul><li><ul><li><a href=#kubectl>Kubectl</a></li><li><a href=#kind>KIND</a></li><li><a href=#minikube>Minikube</a></li></ul></li></ul></li></ul></li><li><a href=#kubernetes-on-aws>Kubernetes on AWS</a><ul><li><a href=#eks--elastic-kubernets-service>EKS ( Elastic Kubernets Service)</a></li><li><a href=#install-kubectl>Install KubeCtl</a><ul><li><a href=#primary-scalar-types>Primary scalar types</a></li></ul></li></ul></li></ul><ul><li><a href=#aks-azure-kubernetes-service>AKS (Azure Kubernetes Service)</a><ul><li><ul><li><a href=#aks>AKS</a><ul><li><a href=#enable-add-on>Enable Add-on</a></li></ul></li><li><a href=#acr>ACR</a></li><li><a href=#aksacrazuredevops-complete-reference-architecture>AKS|ACR|AzureDevops Complete Reference Architecture</a></li><li><a href=#aks-features-and-references-articles>AKS Features and References articles</a><ul><li><a href=#service-principal>Service Principal</a></li><li><a href=#authn-and-authz>Authn and Authz</a></li><li><a href=#cluster-security>Cluster Security</a></li><li><a href=#data-volume>Data Volume</a></li><li><a href=#network-plugin>Network Plugin</a></li><li><a href=#network-policiy>Network Policiy</a></li><li><a href=#load-balancer>Load Balancer</a></li><li><a href=#ingress>Ingress</a></li><li><a href=#egress>Egress</a></li><li><a href=#dns>DNS</a></li><li><a href=#autoscale>Autoscale</a></li><li><a href=#gpu-nodes>GPU nodes</a></li><li><a href=#quota-and-limits-for-aks>Quota and Limits for AKS</a></li><li><a href=#troubleshooting>Troubleshooting</a></li><li><a href=#azure-container-registory-acr>Azure Container Registory (ACR)</a></li><li><a href=#useful-links>Useful Links</a></li></ul></li></ul></li></ul></li><li><a href=#1-requirements>1 Requirements</a></li><li><a href=#2-installation>2 Installation</a><ul><li><a href=#21-create-your-project>2.1 Create Your Project</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=docker>Docker</h2><h3 id=install-docker>Install Docker</h3><h4 id=install-docker-windows>Install Docker: Windows</h4><p>Use the following URL and download the installation file:
<a href=https://hub.docker.com/editions/community/docker-ce-desktop-windows target=_blank rel="noopener noreffer">https://hub.docker.com/editions/community/docker-ce-desktop-windows</a></p><h4 id=install-docker-linux>Install Docker: Linux</h4><p>Use the following URL and download the installation file:
<a href=https://hub.docker.com/editions/community/docker-ce-desktop-windows target=_blank rel="noopener noreffer">https://hub.docker.com/editions/community/docker-ce-desktop-windows</a></p><h4 id=install-docker-mac>Install Docker: Mac</h4><p>Use the following URL and download the installation file:
<a href=https://hub.docker.com/editions/community/docker-ce-desktop-windows target=_blank rel="noopener noreffer">https://hub.docker.com/editions/community/docker-ce-desktop-windows</a></p><h5 id=commands>Commands</h5><p>$ docker version // docker version</p><p>ps – list containers</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps>  <span class=nf>docker</span> <span class=nf>ps</span>
  <span class=nf>docker</span> <span class=nf>ps</span> <span class=nf>-a</span>
</code></pre></td></tr></table></div></div><p>Stop container</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>  docker stop [name of container]
</code></pre></td></tr></table></div></div><p>Remove a container</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker rm [name of container]
</code></pre></td></tr></table></div></div><p>List images</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker images
</code></pre></td></tr></table></div></div><p>Remove images</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker rmi nginx   ///! Delete all dependent containers to remove image
</code></pre></td></tr></table></div></div><p>Download image</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run nginx
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker pull nginx
</code></pre></td></tr></table></div></div><h4 id=exec--execute-a-command>Exec – execute a command</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker exec &lt;&lt;name of image&gt;&gt; cat /etc/hosts

</code></pre></td></tr></table></div></div><h5 id=run--attach-and-detach>Run – attach and detach</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run kodekloud/simple-webapp
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run –d kodekloud/simple-webapp
</code></pre></td></tr></table></div></div><h5 id=run--tag>Run – tag</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run redis:4.0 TAG
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run –i kodekloud/simple-prompt-docker
</code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href=../conainerization/port-mapping.png title="Summary Preview" data-thumbnail=/conainerization/port-mapping.png data-sub-html="<h2>Port Mapping</h2><p>Summary Preview</p>"><img class=lazyload src=../svg/loading.min.svg data-src=../conainerization/port-mapping.png data-srcset="../conainerization/port-mapping.png, ../conainerization/port-mapping.png 1.5x, ../conainerization/port-mapping.png 2x" data-sizes=auto alt=/conainerization/port-mapping.png width=1352 height=697></a><figcaption class=image-caption>Port Mapping</figcaption></figure></p><h4 id=run-volume-mapping>Run volume mapping</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run –v /opt/datadir:/var/lib/mysql mysql
</code></pre></td></tr></table></div></div><p><img class=lazyload src=../svg/loading.min.svg data-src=../conainerization/volume-mapping.png data-srcset="../conainerization/volume-mapping.png, ../conainerization/volume-mapping.png 1.5x, ../conainerization/volume-mapping.png 2x" data-sizes=auto alt=/conainerization/volume-mapping.png title="Volume Mapping" width=457 height=237></p><h5 id=inspect-container>Inspect container</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker inspect &lt;&lt;container name&gt;&gt;
</code></pre></td></tr></table></div></div><h5 id=containers-log>Container&rsquo;s log</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker logs &lt;&lt;container name&gt;&gt;
</code></pre></td></tr></table></div></div><h5 id=environment-variable>Environment variable</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker run -e APP_COLOR=blue simple-webapp-color
</code></pre></td></tr></table></div></div><p>`
Dockerfile</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>FROM Ubuntu   #OS - Ubuntu
RUN apt-get update  #Update apt repo
RUN apt-get install python    #Install dependencies using apt
RUN pip install flask      #Install Python dependencies using pip
RUN pip install flask-mysql
COPY . /opt/source-code     #Copy source code to /opt folder
ENTRYPOINT FLASK_APP=/opt/source-code/app.py flask run  #Run the web server using “flask” command
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>docker build Dockerfile –t mmumshad/my-custom-app
docker push mmumshad/my-custom-app D 
</code></pre></td></tr></table></div></div><h4 id=docker-networking>Docker Networking</h4><p>Docker provides different network settings for Linux and Windows.</p><p>For Linux, there are six pre-configured network options:</p><ol><li>Bridge</li><li>Host</li><li>Overlay</li><li>IPvLan</li><li>MACvLan</li><li>None</li></ol><p>For Windows, there are six pre-configured network options:</p><ol><li>NAT (Network Address Translation)</li><li>Transparent</li><li>Overlay</li><li>L2Bridge</li><li>L2Tunnel</li><li>None
You choose which of these network configurations to apply to your container depending on its network requirements.</li></ol><h2 id=kubernetes>Kubernetes</h2><p><a href=https://github.com/zealvora/certified-kubernetes-application-developer target=_blank rel="noopener noreffer">https://github.com/zealvora/certified-kubernetes-application-developer</a></p><h5 id=kubectl>Kubectl</h5><p><em>kubectl</em>, allows you to run commands against Kubernetes clusters.
Install kubectl
<a href=https://kubernetes.io/docs/tasks/tools/ target=_blank rel="noopener noreffer">https://kubernetes.io/docs/tasks/tools/</a></p><h5 id=kind>KIND</h5><h5 id=minikube>Minikube</h5><p><a href=https://minikube.sigs.k8s.io/docs/start/ target=_blank rel="noopener noreffer">https://minikube.sigs.k8s.io/docs/start/</a></p><p>Lets you run Kubernetes locally</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>minikube start
minikube start --vm-driver hyperv --hyperv-virtual-switch &#34;Default Switch&#34; 
kubectl get nodes 
</code></pre></td></tr></table></div></div><p>Open minikube dashboard <code>minikube dashboard</code></p><h2 id=kubernetes-on-aws>Kubernetes on AWS</h2><h3 id=eks--elastic-kubernets-service>EKS ( Elastic Kubernets Service)</h3><h3 id=install-kubectl>Install KubeCtl</h3><p>Reference: <a href=https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html target=_blank rel="noopener noreffer">https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html</a></p><h4 id=primary-scalar-types>Primary scalar types</h4><ul><li>Create Cluster</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>eksctl create cluster --name=eksdemo1 --region=us-east-1 --zones=us-east-1a,us-east-1b --without-nodegroup 
</code></pre></td></tr></table></div></div><ul><li>Get List of clusters</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>eksctl get cluster 
</code></pre></td></tr></table></div></div><ul><li>Step-02: Create & Associate IAM OIDC Provider for our EKS Cluster
To enable and use AWS IAM roles for Kubernetes service accounts on our EKS cluster, we must create & associate OIDC identity provider.
To do so using eksctl we can use the below command.
Use latest eksctl version (as on today the latest version is 0.21.0)</li></ul><p><strong>Template</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>eksctl utils associate-iam-oidc-provider \
    --region region-code \
    --cluster &lt;cluter-name&gt; \
    --approve
</code></pre></td></tr></table></div></div><p>Replace with region & cluster name</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>eksctl utils associate-iam-oidc-provider   --region us-east-1   --cluster eksdemo1   --approve
</code></pre></td></tr></table></div></div><ul><li>Step-03: Create EC2 Keypair
Create a new EC2 Keypair with name as kube-demo
This keypair we will use it when creating the EKS NodeGroup.
This will help us to login to the EKS Worker Nodes using Terminal.
Step-04: Create Node Group with additional Add-Ons in Public Subnets
These add-ons will create the respective IAM policies for us automatically within our Node Group role.</li><li>Create Public Node Group</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>eksctl create nodegroup --cluster=eksdemo1 \
                       --region=us-east-1 \
                       --name=eksdemo1-ng-public1 \
                       --node-type=t3.medium \
                       --nodes=2 \
                       --nodes-min=2 \
                       --nodes-max=4 \
                       --node-volume-size=20 \
                       --ssh-access \
                       --ssh-public-key=kube-demo \
                       --managed \
                       --asg-access \
                       --external-dns-access \
                       --full-ecr-access \
                       --appmesh-access \
                       --alb-ingress-access 
</code></pre></td></tr></table></div></div><p><code>eksctl create nodegroup --cluster=eksdemo1 --region=us-east-1 --name=eksdemo1-ng-public1 --node-type=t3.medium --nodes=2 --nodes-min=2 --nodes-max=4 --node-volume-size=20 --ssh-access --ssh-public-key=ekc-ecs-demo-2022 --managed --asg-access --external-dns-access --full-ecr-access --appmesh-access --alb-ingress-access</code></p><p>Step-05: Verify Cluster & Nodes</p><ul><li><p>List EKS clusters
<code>eksctl get cluster</code></p></li><li><p>List NodeGroups in a cluster
<code>eksctl get nodegroup --cluster=&lt;clusterName></code></p></li><li><p>List Nodes in current kubernetes cluster
<code>kubectl get nodes -o wide</code></p></li></ul><h1 id=our-kubectl-context-should-be-automatically-changed-to-new-cluster>Our kubectl context should be automatically changed to new cluster</h1><p>kubectl config view &ndash;minify</p><h2 id=aks-azure-kubernetes-service>AKS (Azure Kubernetes Service)</h2><h4 id=aks>AKS</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>az login
az aks install-cli
</code></pre></td></tr></table></div></div><ul><li>Get k8s available versions</li></ul><p><code>az aks get-versions --location $REGION -o table</code></p><ul><li>To configure kubectl to connect to your Kubernetes cluster<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>az aks get-credentials --resource-group <span class=nv>$RESOURCE_GROUP</span> --name <span class=nv>$CLUSTER_NAME</span>
</code></pre></td></tr></table></div></div></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>* List Kubernetes Worker Nodes
kubectl get nodes 
kubectl get nodes -o wide
</code></pre></td></tr></table></div></div><ul><li>List Namespaces</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>kubectl get namespaces
kubectl get ns 
</code></pre></td></tr></table></div></div><ul><li>List Pods from all namespaces</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>kubectl get pods --all-namespaces
</code></pre></td></tr></table></div></div><ul><li>List all k8s objects from Cluster Control plane</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>kubectl get all --all-namespaces
</code></pre></td></tr></table></div></div><ul><li>Open k8s Dashboard</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>az aks browse --resource-group <span class=nv>$RESOURCE_GROUP</span> --name <span class=nv>$CLUSTER_NAME</span>
</code></pre></td></tr></table></div></div><ul><li>If you&rsquo;re using RBAC enabled kubernetes cluster, you need to configure Service Account and RoleBinding in order to make Dashbaord work.Here is a way to give full privilege (role: cluster-admin) to the Dashboard&rsquo;s Service Account kubernetes-dashboard</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>    # Here is a way to give full privilege (role: cluster-admin) to the Dashboard’s Service Account kubernetes-dashboard
    $ cat &lt;&lt;EOF | kubectl apply -f -
    apiVersion: rbac.authorization.k8s.io/v1beta1
    kind: ClusterRoleBinding
    metadata:
    name: kubernetes-dashboard
    labels:
        k8s-app: kubernetes-dashboard
    roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: cluster-admin
    subjects:
    - kind: ServiceAccount
    name: kubernetes-dashboard
    namespace: kube-system
    EOF
</code></pre></td></tr></table></div></div><ul><li><p>Get cluster Info
<code>az aks show --resource-group $RESOURCE_GROUP --name $CLUSTER_NAME -o table</code></p></li><li><p>Get Node group info
<code>az aks show --resource-group $RESOURCE_GROUP --name $CLUSTER_NAME --query nodeResourceGroup -o tsv</code>
*Scale AKS Cluster nodes
<code>az aks scale --name $CLUSTER_NAME --resource-group $RESOURCE_GROUP --node-count $NODE_COUNT</code>
Upgrade AKS Cluster version
<code>az aks upgrade --name $CLUSTER_NAME --resource-group $RESOURCE_GROUP --kubernetes-version $KUBERNETS_VERSION</code></p></li><li><p>Check which Kubernetes releases are available for upgrade for your AKS cluster
az aks get-upgrades &ndash;name $CLUSTER_NAME &ndash;resource-group $RESOURCE_GROUP -o table</p></li></ul><h5 id=enable-add-on>Enable Add-on</h5><ul><li><p>Enable Azure Monitor for Containers
OMS_WORKSPACE_RESOURCE_ID="/subscriptions/87c7c7f9-0c9f-47d1-a856-1305a0cbfd7a/resourceGroups/DefaultResourceGroup-EJP/providers/Microsoft.OperationalInsights/workspaces/DefaultWorkspace-77c7c7f9-0c9f-47d1-a856-1305a0cbfd7a-EJP"
<code>az aks enable-addons -a monitoring --name $CLUSTER_NAME --resource-group $RESOURCE_GROUP --workspace-resource-id $OMS_WORKSPACE_RESOURCE_ID</code></p></li><li><p>Enable HTTP Application Routing
<code>az aks enable-addons --addons http_application_routing --name $CLUSTER_NAME --resource-group $RESOURCE_GROUP</code></p></li><li><p>Check egress IP
<code>kubectl run -it --rm runtest --image=debian --generator=run-pod/v1 pod> apt-get update && apt-get install curl -y pod> curl -s checkip.dyndns.org</code></p></li></ul><h4 id=acr>ACR</h4><ul><li><p>Create an Azure Container Registry
<code>az acr create --resource-group $RESOURCE_GROUP --name $ACR_NAME --sku Basic</code>
SKU: Basic, Standard, Premium, Classic</p></li><li><p>Get ACR list
<code>az acr list -o table</code></p></li><li><p>Get ACR Detail
<code>az acr show -n $ACR_NAME -g $RESOURCE_GROUP</code></p></li><li><p>Get only ACR ID
<code>az acr show -n $ACR_NAME -g $RESOURCE_GROUP --query "id" -o tsv</code></p></li><li><p>Show ACR Repositories</p></li></ul><ul><li>Show list of repositories
<code>az acr repository list -n $ACR_NAME -o table</code></li><li>Show the detail of a repository
<code>az acr repository show -n $ACR_NAME --repository $REPO_NAME -o table</code></li><li>Show list of tags in a repository
<code>az acr repository show-tags -n $ACR_NAME --repository $REPO_NAME -o table</code></li></ul><ul><li>Login to ACR
<code>az acr login --name $ACR_NAME</code></li></ul><ul><li>Alternatively login with docker command</li></ul><p><code>ACR_LOGIN_SERVER=$ACR_NAME.azurecr.io docker login $ACR_LKOGIN_SERVER -u $ACR_USER -p $ACR_PASSWORD</code></p><ul><li>ACR Task - Build
<code>az acr build --registry $ACR_NAME --image [CONTAINER_NAME:TAG] [SOURCE_LOCATION]</code></li></ul><ul><li>More usages are:</li><li>Queue a local context (folder), pushed to ACR when complete, with streaming logs.
<code>az acr build -t sample/hello-world:{{.Run.ID}} -r MyRegistry .</code></li><li>Queue a local context, pushed to ACR without streaming logs.
<code>az acr build -t sample/hello-world:{{.Run.ID}} -r MyRegistry --no-logs .</code></li><li>Queue a local context to validate a build is successful, without pushing to the registry using the &ndash;no-push parameter.
<code>az acr build -t sample/hello-world:{{.Run.ID}} -r MyRegistry --no-push .</code></li></ul><ul><li>Queue a local context to validate a build is successful, without pushing to the registry. Removing the -t parameter defaults to &ndash;no-push
<code>az acr build -r MyRegistry .</code></li></ul><h4 id=aksacrazuredevops-complete-reference-architecture>AKS|ACR|AzureDevops Complete Reference Architecture</h4><p><img class=lazyload src=../svg/loading.min.svg data-src=https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/images/aks.svg data-srcset="https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/images/aks.svg, https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/images/aks.svg 1.5x, https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/images/aks.svg 2x" data-sizes=auto alt=https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/images/aks.svg title=https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/containers/aks-microservices/images/aks.svg></p><ul><li><a href=https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/microservices/aks target=_blank rel="noopener noreffer">Microservices architecture on Azure Kubernetes Service (AKS)</a></li><li><a href=https://github.com/mspnp/microservices-reference-implementation target=_blank rel="noopener noreffer">https://github.com/mspnp/microservices-reference-implementation</a></li><li><a href=https://docs.microsoft.com/en-us/azure/architecture/microservices/index target=_blank rel="noopener noreffer">Building microservices on Azure</a></li></ul><h4 id=aks-features-and-references-articles>AKS Features and References articles</h4><h5 id=service-principal>Service Principal</h5><ul><li>About Service Principal<ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/kubernetes-service-principal target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/aks/kubernetes-service-principal</a></li></ul></li><li>Update Service Principal in AKS cluster<ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/update-credentials target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/aks/update-credentials</a></li></ul></li></ul><h5 id=authn-and-authz>Authn and Authz</h5><ul><li>3 options to manage access and identity for AKS clusters<ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/aad-integration target=_blank rel="noopener noreffer">Azure RBAC (integration with Azure AD) to control the access to AKS</a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>1. Developer authenticates with Azure AD(AAD).
2. AAD token issuance endpoint issues the access token.
3. The developer performs an action using the AAD token, such as kubectl create pod
4. k8s validates the token with AAD and fetches the developer&#39;s group memberships.
5. k8s RBAC and cluster policies are applied.
6. Developer&#39;s request is successful or not based on previous validation of AAD group membership and k8s RBAC and policies.
</code></pre></td></tr></table></div></div>from <a href=https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-identity target=_blank rel="noopener noreffer">Bast pracitses for authn & authz in AKS</a></li><li>Kubernetes RBAC<ul><li><a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/ target=_blank rel="noopener noreffer">Using RBAC Authorization@k8s.io</a></li><li>Roles, ClusterRoles, RoleBindings, ClusterRoleBindings</li></ul></li><li>Pod Identities<ul><li>Use managed identities for Pods in AKS to access to Azure resources<ul><li>Managed Identities let you automatically request access to services through Azure AD. You don&rsquo;t manually define credentials for pods, instead they request an access token in real time (See <a href=https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-identity#use-pod-identities target=_blank rel="noopener noreffer">azure doc</a>)</li></ul></li><li><a href=https://github.com/Azure/aad-pod-identity target=_blank rel="noopener noreffer">Use Pod Identities(Managed Identity)</a></li></ul></li></ul></li></ul><h5 id=cluster-security>Cluster Security</h5><ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-cluster-security target=_blank rel="noopener noreffer">cluster security and upgrades</a><ul><li>Securing access to the API server, limiting container access, and managing upgrades and node reboots.</li></ul></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-container-image-management target=_blank rel="noopener noreffer">Container image management and security</a><ul><li>Securing the image and runtimes, using trusted registries, and automated builds on base image updates..</li></ul></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/developer-best-practices-pod-security target=_blank rel="noopener noreffer">Pod security</a><ul><li>Securing access to resources, limiting credential exposure, and using <a href=https://docs.microsoft.com/en-us/azure/aks/operator-best-practices-identity#use-pod-identities target=_blank rel="noopener noreffer">pod identities</a> and <a href=https://docs.microsoft.com/en-us/azure/aks/developer-best-practices-pod-security#use-azure-key-vault-with-flexvol target=_blank rel="noopener noreffer">Azure Key Vault</a></li><li><a href=https://github.com/Azure/kubernetes-keyvault-flexvol target=_blank rel="noopener noreffer">KeyVault with FlexVol@Github page</a></li></ul></li></ul><h5 id=data-volume>Data Volume</h5><ul><li>Data Volume Options<ul><li>Azure Disk (<a href=https://docs.microsoft.com/en-us/azure/aks/azure-disks-dynamic-pv target=_blank rel="noopener noreffer">Dynamic</a> / <a href=https://docs.microsoft.com/en-us/azure/aks/azure-disk-volume target=_blank rel="noopener noreffer">Static</a>)</li><li>Azure Files (<a href=https://docs.microsoft.com/en-us/azure/aks/azure-files-dynamic-pv target=_blank rel="noopener noreffer">Dynamic</a> / <a href=https://docs.microsoft.com/en-us/azure/aks/azure-files-volume target=_blank rel="noopener noreffer">Static</a>)</li></ul></li></ul><h5 id=network-plugin>Network Plugin</h5><ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/configure-kubenet target=_blank rel="noopener noreffer">kubenet</a> (default policy)<ul><li>az aks create &ndash;network-plugin option: kubenet</li><li>see also <a href=https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet target=_blank rel="noopener noreffer">k8s.io</a></li></ul></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/configure-azure-cni target=_blank rel="noopener noreffer">Azure CNI</a><ul><li>az aks create &ndash;network-plugin option: azure</li></ul></li></ul><h5 id=network-policiy>Network Policiy</h5><ul><li>Kubernetes version: <code>1.12+</code></li><li><a href=https://github.com/ahmetb/kubernetes-network-policy-recipes target=_blank rel="noopener noreffer">Network Policy Recipes</a></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/use-network-policies target=_blank rel="noopener noreffer">Network policy Options in AKS</a><ul><li><ol><li><code>Azure Network Policies</code> - the Azure CNI sets up a bridge in the VM host for intra-node networking. The filtering rules are applied when the packets pass through the bridge</li></ol><ul><li>az aks create &ndash;network-plugin <code>azure</code></li></ul></li><li><ol start=2><li><code>Calico Network Policies</code> - the Azure CNI sets up local kernel routes for the intra-node traffic. The policies are applied on the pod’s network interface.</li></ol><ul><li>see [the difference between the two](the Azure CNI sets up local kernel routes for the intra-node traffic. The policies are applied on the pod’s network interface.)</li><li>az aks create &ndash;network-plugin <code>azure</code> && &ndash;network-policy <code>calico</code></li></ul></li></ul></li></ul><h5 id=load-balancer>Load Balancer</h5><ul><li>Service: type=<code>LoadBalancer</code> (NOT <code>ClusterIP</code> nor <code>NodePort</code>)</li><li>Default: External Load balancer</li><li>Static IP to LB (see <a href=https://docs.microsoft.com/en-us/azure/aks/static-ip target=_blank rel="noopener noreffer">azure doc</a>)<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>servicename</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>loadBalancerIP</span><span class=p>:</span><span class=w> </span><span class=m>41.222.222.66</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>LoadBalancer</span><span class=w>
</span></code></pre></td></tr></table></div></div></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/internal-lb target=_blank rel="noopener noreffer">Internal Load balancer</a> - Only accessible from the same VNET<ul><li>Annotation for Internal LB<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>servicename</span><span class=w>
</span><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>service.beta.kubernetes.io/azure-load-balancer-internal</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>LoadBalancer</span><span class=w>
</span><span class=w>    </span><span class=l>...</span><span class=w>
</span></code></pre></td></tr></table></div></div></li><li>You can specify IP address for LB: <code>loadBalancerIP:XX.XX.XX.XX</code></li><li>You can specify a subnet for LB with special annotation<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-YAML data-lang=YAML><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>service.beta.kubernetes.io/azure-load-balancer-internal</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>
</span><span class=w>    </span><span class=nt>service.beta.kubernetes.io/azure-load-balancer-internal-subnet</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;apps-subnet&#34;</span><span class=w>
</span></code></pre></td></tr></table></div></div></li></ul></li></ul><h5 id=ingress>Ingress</h5><ul><li>Ingress Controllers provided by Azure (Not <a href=https://github.com/kubernetes/ingress-nginx target=_blank rel="noopener noreffer">nginx ingress</a> or others)<ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/http-application-routing target=_blank rel="noopener noreffer">HTTP application routing add-on</a></li><li><a href=https://github.com/Azure/application-gateway-kubernetes-ingress target=_blank rel="noopener noreffer">Application Gateway Kubernetes Ingress</a></li></ul></li><li>TLS Termination Configfuration<ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/ingress-own-tls target=_blank rel="noopener noreffer">Your Certificates</a></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/ingress-tls target=_blank rel="noopener noreffer">Let&rsquo;s Encrypt</a></li></ul></li><li>Ingress for Internal VNET by using a service with <a href=https://docs.microsoft.com/en-us/azure/aks/internal-lb target=_blank rel="noopener noreffer">Internal LB</a></li></ul><h5 id=egress>Egress</h5><ul><li>Static IP for egress traffic<ul><li>See <a href=https://docs.microsoft.com/en-us/azure/aks/egress target=_blank rel="noopener noreffer">azure doc</a></li><li>Default: egress IP from AKS is randomly assigned<blockquote><p>Once a Kubernetes service of type LoadBalancer is created, agent nodes are added to an Azure Load Balancer pool. For outbound flow, Azure translates it to the first public IP address configured on the load balancer. This public IP address is only valid for the lifespan of that resource. If you delete the Kubernetes LoadBalancer service, the associated load balancer and IP address are also deleted.</p></blockquote></li><li>Procedures<ul><li><ol><li>Create static IP in AKS node resource Group</li></ol></li><li><ol start=2><li>Create a service with the static IP ( put the static IP to the <code>loadBalancerIP</code> property)</li></ol></li></ul></li></ul></li></ul><h5 id=dns>DNS</h5><ul><li>Kubernetes +1.12.x: <code>CoreDNS</code><ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/coredns-custom target=_blank rel="noopener noreffer">Customize CoreDNS</a></li></ul></li><li>Kubernetes &lt; 1.12.x: <code>kube-dns</code><ul><li><a href=https://www.danielstechblog.io/using-custom-dns-server-for-domain-specific-name-resolution-with-azure-kubernetes-service/ target=_blank rel="noopener noreffer">Customize kube-dns</a></li></ul></li></ul><h5 id=autoscale>Autoscale</h5><h5 id=gpu-nodes>GPU nodes</h5><ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/gpu-cluster target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/aks/gpu-cluster</a></li></ul><h5 id=quota-and-limits-for-aks>Quota and Limits for AKS</h5><ul><li><a href=https://docs.microsoft.com/en-us/azure/aks/container-service-quotas target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/aks/container-service-quotas</a></li><li>Default limit<ul><li>max clusters per subscription: <code>100</code></li><li>max nodes per cluster: <code>100</code></li><li>max pods per node setting for AKS<ul><li>Basic networking with Kubenet: <code>110</code></li><li>Advanced networking with Azure CNI: <code>30</code> ( NOTE: you can change the limit for Azure CLI or Resource Manager template deployments up to <code>110</code> )</li></ul></li></ul></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/container-service-quotas#region-availability target=_blank rel="noopener noreffer">Region availability</a></li><li><a href=https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits target=_blank rel="noopener noreffer">Provisioned Infrastructure</a></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/supported-kubernetes-versions target=_blank rel="noopener noreffer">Supported k8s versions</a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>az aks get-versions --location $REGION -o table
</code></pre></td></tr></table></div></div></li></ul><h5 id=troubleshooting>Troubleshooting</h5><ul><li><a href=https://kubernetes.io/docs/tasks/debug-application-cluster/troubleshooting/ target=_blank rel="noopener noreffer">Official troubleshooting Guide @k8s.io</a></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/troubleshooting target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/aks/troubleshooting</a></li><li><a href=https://github.com/feiskyer/kubernetes-handbook/blob/master/en/troubleshooting/index.md target=_blank rel="noopener noreffer">Kubernetes Troubleshooting @Github</a></li><li><a href=https://docs.microsoft.com/en-us/azure/aks/kube-advisor-tool target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/aks/kube-advisor-tool</a></li><li><a href=https://github.com/yokawasa/kubectl-plugin-ssh-jump target=_blank rel="noopener noreffer">SSH login to k8s nodes</a></li></ul><h5 id=azure-container-registory-acr>Azure Container Registory (ACR)</h5><ul><li>VNET & Firewall Rule<ul><li><a href=https://docs.microsoft.com/en-us/azure/container-registry/container-registry-vnet target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-vnet</a></li></ul></li><li>ACR Task - Automate OS and framework patching<ul><li><a href=http://aka.ms/acr/tasks target=_blank rel="noopener noreffer">http://aka.ms/acr/tasks</a></li><li><a href=https://docs.microsoft.com/en-us/azure/container-registry/container-registry-tasks-multi-step target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-tasks-multi-step</a></li></ul></li><li>Repo & Tag Locking<ul><li><a href=http://aka.ms/acr/tag-locking target=_blank rel="noopener noreffer">http://aka.ms/acr/tag-locking</a></li></ul></li><li>Helm Chart Repositories<ul><li><a href=https://docs.microsoft.com/en-us/azure/container-registry/container-registry-helm-repos target=_blank rel="noopener noreffer">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-helm-repos</a></li></ul></li></ul><h5 id=useful-links>Useful Links</h5><ul><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/ target=_blank rel="noopener noreffer">kubectl Cheat Sheet</a></li><li><a href=https://linuxacademy.com/blog/containers/kubernetes-cheat-sheet/ target=_blank rel="noopener noreffer">Kubernetes Cheat Sheet (Linux Academy)</a></li><li><a href=https://gist.github.com/tuannvm/4e1bcc993f683ee275ed36e67c30ac49 target=_blank rel="noopener noreffer">Helm Cheat Sheet</a></li></ul><ol><li>Create a resource group</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>az group create --name devopresources --location westeurope    
</code></pre></td></tr></table></div></div><ol start=2><li>Create ACR (Azure container repository)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>az acr create --resource-group devopresources --name devopsshoppingacr --sku Basic
</code></pre></td></tr></table></div></div><ol start=3><li>Enable admin access on the ACR repor</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>az acr update --resource-group devopresources --n devopsshoppingacr --admin-enabled <span class=nb>true</span>
</code></pre></td></tr></table></div></div><h2 id=1-requirements>1 Requirements</h2><p>eyteyhdhgh
Thanks to the simplicity of Hugo, <a href=https://gohugo.io/ target=_blank rel="noopener noreffer">Hugo</a> is the only dependency of this theme.</p><p>Just install latest version of <a href=https://gohugo.io/getting-started/installing/ target=_blank rel="noopener noreffer"><i class="far fa-file-archive fa-fw" aria-hidden=true></i>&nbsp;Hugo (> 0.84.0)</a> for your OS (<strong>Windows</strong>, <strong>Linux</strong>, <strong>macOS</strong>).</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Why not support earlier versions of Hugo?<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Since <a href=https://gohugo.io/getting-started/configuration-markup#markdown-render-hooks target=_blank rel="noopener noreffer">Markdown Render Hooks</a> was introduced in the <a href=https://gohugo.io/news/0.62.0-relnotes/ target=_blank rel="noopener noreffer">Hugo Christmas Edition</a> and some of image resources are using webp which was introduced in <a href=https://github.com/gohugoio/hugo/releases/tag/v0.84.0 target=_blank rel="noopener noreffer">0.84.0</a>, this theme only supports Hugo versions above <strong>0.84.0</strong>.</div></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Hugo extended version is recommended<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Since some features of this theme need to processes <i class="fab fa-sass fa-fw" aria-hidden=true></i>&nbsp;SCSS to <i class="fab fa-css3 fa-fw" aria-hidden=true></i>&nbsp;CSS, it is recommended to use Hugo <strong>extended</strong> version for better experience.</div></div></div><h2 id=2-installation>2 Installation</h2><p>The following steps are here to help you initialize your new website. If you don’t know Hugo at all, we strongly suggest you learn more about it by following this <a href=https://gohugo.io/getting-started/quick-start/ target=_blank rel="noopener noreffer">great documentation for beginners</a>.</p><h3 id=21-create-your-project>2.1 Create Your Project</h3><p>Hugo provides a <code>new</code> command to create a new website:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>hugo new site my_website
<span class=nb>cd</span> my_website
</code></pre></td></tr></table></div></div><p>testigggg</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-09-12&nbsp;<a class=git-hash href=https://github.com/khusika/FeelIt/commit/19659e0f0d4af32fbe89ef6ebcd49ee3e248db66 target=_blank title="commit by Sharad(sharadit2011@hotmail.com) 19659e0f0d4af32fbe89ef6ebcd49ee3e248db66: docker networking from ms leaqrn">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>19659e0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=../conainerization/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://localhost:1313/learn/conainerization/ data-title="Docker and Kubernets"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://localhost:1313/learn/conainerization/ data-title="Docker and Kubernets"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=../tags/docker/>docker</a>,&nbsp;<a href=../tags/kubernets/>kubernets</a>,&nbsp;<a href=../tags/container/>container</a>,&nbsp;<a href=../tags/microservice/>microservice</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=../>Home</a></span></section></div><div class=post-nav><a href=../theme-documentation-basics/ class=prev rel=prev title="Theme Documentation - Basics"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Theme Documentation - Basics</a>
<a href=../labs/ class=next rel=next title="Clouds Labs">Clouds Labs<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.sharadsingh.net/ target=_blank>Sharad</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{},lightgallery:!0,search:{algoliaAppID:"UAL0NNJWXE",algoliaIndex:"index.en",algoliaSearchKey:"7b7fbdfb7ee82ee61901f2c6b09b05be",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=../js/theme.min.js></script></body></html>